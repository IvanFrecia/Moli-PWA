<div class="orders-container">
  <div class="header">
    <h1 class="text-2xl font-bold mb-4">Mis Pedidos</h1>
    <a mat-raised-button color="primary" routerLink="/orders/new">
      <mat-icon>add</mat-icon>
      Nuevo Pedido
    </a>
  </div>

  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Cargando pedidos...</p>
    </div>
  } @else {
    @if (orders().length === 0) {
      <mat-card class="empty-state">
        <mat-card-content class="text-center py-8">
          <mat-icon class="text-6xl text-gray-400 mb-4">receipt</mat-icon>
          <h2 class="text-xl font-semibold mb-2">No hay pedidos</h2>
          <p class="text-gray-600 mb-4">Crea tu primer pedido para comenzar</p>
          <a mat-raised-button color="primary" routerLink="/orders/new">
            Crear Pedido
          </a>
        </mat-card-content>
      </mat-card>
    } @else {
      <mat-card>
        <mat-card-content class="p-0">
          <table mat-table [dataSource]="orders()" class="w-full">
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>ID</th>
              <td mat-cell *matCellDef="let order">#{{ order.id }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Estado</th>
              <td mat-cell *matCellDef="let order">
                <mat-chip [color]="getStatusColor(order.status)">
                  {{ order.status }}
                </mat-chip>
              </td>
            </ng-container>

            <ng-container matColumnDef="total">
              <th mat-header-cell *matHeaderCellDef>Total</th>
              <td mat-cell *matCellDef="let order">
                ${{ order.total | number:'1.2-2' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="createdAt">
              <th mat-header-cell *matHeaderCellDef>Fecha</th>
              <td mat-cell *matCellDef="let order">
                {{ order.createdAt | date:'dd/MM/yyyy HH:mm' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Acciones</th>
              <td mat-cell *matCellDef="let order">
                <div class="actions">
                  @if (order.canEdit) {
                    <button mat-icon-button 
                            color="primary"
                            [routerLink]="['/orders', order.id, 'edit']">
                      <mat-icon>edit</mat-icon>
                    </button>
                  }
                  
                  @if (order.status === 'Enviado') {
                    <button mat-icon-button 
                            color="accent"
                            [routerLink]="['/tracking', order.id]">
                      <mat-icon>location_on</mat-icon>
                    </button>
                  }
                  
                  @if (order.status === 'Aprobado' && currentUser()?.role !== 'empleado_panaderia') {
                    <button mat-icon-button 
                            color="warn"
                            [routerLink]="['/payments', order.id]">
                      <mat-icon>payment</mat-icon>
                    </button>
                  }
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </mat-card-content>
      </mat-card>
    }
  }
</div>
